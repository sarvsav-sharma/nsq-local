version: "3"
services:
   weave-nsq-admin:
     image: nsqio/nsq
     command: /nsqadmin  -lookupd-http-address weave-nsq-nsqlookupd1:4161  -lookupd-http-address  weave-nsq-nsqlookupd2:4261
     ports:
     - "4171:4171"
   weave-nsq-nsqd1:
     image: nsqio/nsq
     hostname: weave-nsq-nsqd1
     command: /nsqd -tcp-address 0.0.0.0:4150 -data-path /usr/local/nsq/bin/data   --http-address 0.0.0.0:4151 -lookupd-tcp-address weave-nsq-nsqlookupd1:4160  -lookupd-tcp-address weave-nsq-nsqlookupd2:4260 -broadcast-address weave-nsq-nsqd1
     volumes:
     - "./data1:/usr/local/nsq/bin/data"
     ports:
     - "4150:4150"
     - "4151:4151"
   weave-nsq-nsqd2:
     image: nsqio/nsq
     hostname: weave-nsq-nsqd2
     command: /nsqd -tcp-address 0.0.0.0:4250 -data-path /usr/local/nsq/bin/data  -http-address 0.0.0.0:4251 -lookupd-tcp-address weave-nsq-nsqlookupd1:4160  -lookupd-tcp-address  weave-nsq-nsqlookupd2:4260 -broadcast-address=weave-nsq-nsqd2
     volumes:
     - "./data2:/usr/local/nsq/bin/data"
     ports:
     - "4250:4250"
     - "4251:4251"
   weave-nsq-nsqd3:
     image: nsqio/nsq
     hostname: weave-nsq-nsqd3
     command: /nsqd -tcp-address 0.0.0.0:4350 -data-path /usr/local/nsq/bin/data  --http-address 0.0.0.0:4351 -lookupd-tcp-address weave-nsq-nsqlookupd1:4160  -lookupd-tcp-address  weave-nsq-nsqlookupd2:4260 -broadcast-address=weave-nsq-nsqd3
     volumes:
     - "./data3:/usr/local/nsq/bin/data"
     ports:
     - "4354:4350"
     - "4355:4351"
   weave-nsq-nsqlookupd1:
     image: nsqio/nsq
     command: /nsqlookupd   -http-address 0.0.0.0:4161  -tcp-address 0.0.0.0:4160 -broadcast-address weave-nsq-nsqlookupd1
     ports:
     - "4160:4160"
     - "4161:4161"
   weave-nsq-nsqlookupd2:
     image: nsqio/nsq
     command: /nsqlookupd -http-address 0.0.0.0:4261  -tcp-address 0.0.0.0:4260 -broadcast-address weave-nsq-nsqlookupd2
     ports:
     - "4260:4260"
     - "4261:4261"